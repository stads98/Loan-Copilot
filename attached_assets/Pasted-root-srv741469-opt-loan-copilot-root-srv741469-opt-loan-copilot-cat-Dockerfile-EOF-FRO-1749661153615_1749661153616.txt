root@srv741469:/opt/loan-copilot# root@srv741469:/opt/loan-copilot# cat > Dockerfile << 'EOF'
> FROM node:18-alpine
> WORKDIR /app
> COPY package*.json ./
> RUN npm install
> COPY . .
> RUN chmod -R 755 node_modules/.bin/ || true
> RUN npm run build
> RUN mkdir -p uploads
> # Don't remove vite - it's needed for runtime
> # RUN npm prune --production
> EXPOSE 5000
> ENV NODE_ENV=production
> ENV PORT=5000
D ["np> CMD ["npm", "start"]
> EOF
root@srv741469:/opt/loan-copilot# docker-compose down --remove-orphans
[+] Running 4/4
 ✔ Container loan-copilot-app-1       Removed                                                                      0.0s
 ✔ Container loan-copilot-postgres-1  Removed                                                                      0.2s
 ✔ Container loan-copilot-nginx-1     Removed                                                                      0.2s
 ✔ Network loan-copilot_default       Removed                                                                      0.1s
root@srv741469:/opt/loan-copilot# systemctl start nginx
root@srv741469:/opt/loan-copilot# docker-compose build --no-cache
[+] Building 93.0s (13/13) FINISHED
 => [app internal] load build definition from Dockerfile                                                           0.0s
 => => transferring dockerfile: 348B                                                                               0.0s
 => [app internal] load metadata for docker.io/library/node:18-alpine                                              1.6s
 => [app internal] load .dockerignore                                                                              0.0s
 => => transferring context: 2B                                                                                    0.0s
 => [app 1/8] FROM docker.io/library/node:18-alpine@sha256:8d6421d663b4c28fd3ebc498332f249011d118945588d0a35cb9bc  0.0s
 => [app internal] load build context                                                                              1.1s
 => => transferring context: 2.25MB                                                                                1.0s
 => CACHED [app 2/8] WORKDIR /app                                                                                  0.0s
 => [app 3/8] COPY package*.json ./                                                                                0.2s
 => [app 4/8] RUN npm install                                                                                     15.4s
 => [app 5/8] COPY . .                                                                                            45.5s
 => [app 6/8] RUN chmod -R 755 node_modules/.bin/ || true                                                          0.4s
 => [app 7/8] RUN npm run build                                                                                    8.3s
 => [app 8/8] RUN mkdir -p uploads                                                                                 0.3s
 => [app] exporting to image                                                                                      20.1s
 => => exporting layers                                                                                           20.1s
 => => writing image sha256:6afcd35f28fb55828dcc8caaa0b0bd970df6f9b8bb9d1df04168552c31d25ba7                       0.0s
 => => naming to docker.io/library/loan-copilot-app                                                                0.0s
root@srv741469:/opt/loan-copilot# docker-compose up -d
[+] Running 3/3
 ✔ Network loan-copilot_default       Created                                                                      0.1s
 ✔ Container loan-copilot-postgres-1  Started                                                                      0.3s
 ✔ Container loan-copilot-app-1       Started                                                                      0.4s
root@srv741469:/opt/loan-copilot# docker-compose ps
NAME                      IMAGE                COMMAND                  SERVICE             CREATED             STATUS              PORTS
loan-copilot-app-1        loan-copilot-app     "docker-entrypoint.s…"   app                 9 seconds ago       Up 1 second         0.0.0.0:5000->5000/tcp, :::5000->5000/tcp
loan-copilot-postgres-1   postgres:15-alpine   "docker-entrypoint.s…"   postgres            9 seconds ago       Up 8 seconds        5432/tcp
root@srv741469:/opt/loan-copilot# docker-compose logs app
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | > rest-express@1.0.0 start
loan-copilot-app-1  | > NODE_ENV=production node dist/index.js
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | OpenAI configuration: API key is set
loan-copilot-app-1  | node:internal/errors:496
loan-copilot-app-1  |     ErrorCaptureStackTrace(err);
loan-copilot-app-1  |     ^
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | TypeError [ERR_INVALID_ARG_TYPE]: The "paths[0]" argument must be of type string. Received undefined
loan-copilot-app-1  |     at new NodeError (node:internal/errors:405:5)
loan-copilot-app-1  |     at validateString (node:internal/validators:162:11)
loan-copilot-app-1  |     at Object.resolve (node:path:1115:7)
loan-copilot-app-1  |     at file:///app/dist/index.js:4796:18
loan-copilot-app-1  |     at ModuleJob.run (node:internal/modules/esm/module_job:195:25)
loan-copilot-app-1  |     at async ModuleLoader.import (node:internal/modules/esm/loader:337:24)
loan-copilot-app-1  |     at async loadESM (node:internal/process/esm_loader:34:7)
loan-copilot-app-1  |     at async handleMainPromise (node:internal/modules/run_main:106:12) {
loan-copilot-app-1  |   code: 'ERR_INVALID_ARG_TYPE'
loan-copilot-app-1  | }
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | Node.js v18.20.8
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | > rest-express@1.0.0 start
loan-copilot-app-1  | > NODE_ENV=production node dist/index.js
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | OpenAI configuration: API key is set
loan-copilot-app-1  | node:internal/errors:496
loan-copilot-app-1  |     ErrorCaptureStackTrace(err);
loan-copilot-app-1  |     ^
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | TypeError [ERR_INVALID_ARG_TYPE]: The "paths[0]" argument must be of type string. Received undefined
loan-copilot-app-1  |     at new NodeError (node:internal/errors:405:5)
loan-copilot-app-1  |     at validateString (node:internal/validators:162:11)
loan-copilot-app-1  |     at Object.resolve (node:path:1115:7)
loan-copilot-app-1  |     at file:///app/dist/index.js:4796:18
loan-copilot-app-1  |     at ModuleJob.run (node:internal/modules/esm/module_job:195:25)
loan-copilot-app-1  |     at async ModuleLoader.import (node:internal/modules/esm/loader:337:24)
loan-copilot-app-1  |     at async loadESM (node:internal/process/esm_loader:34:7)
loan-copilot-app-1  |     at async handleMainPromise (node:internal/modules/run_main:106:12) {
loan-copilot-app-1  |   code: 'ERR_INVALID_ARG_TYPE'
loan-copilot-app-1  | }
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | Node.js v18.20.8
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | > rest-express@1.0.0 start
loan-copilot-app-1  | > NODE_ENV=production node dist/index.js
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | OpenAI configuration: API key is set
loan-copilot-app-1  | node:internal/errors:496
loan-copilot-app-1  |     ErrorCaptureStackTrace(err);
loan-copilot-app-1  |     ^
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | TypeError [ERR_INVALID_ARG_TYPE]: The "paths[0]" argument must be of type string. Received undefined
loan-copilot-app-1  |     at new NodeError (node:internal/errors:405:5)
loan-copilot-app-1  |     at validateString (node:internal/validators:162:11)
loan-copilot-app-1  |     at Object.resolve (node:path:1115:7)
loan-copilot-app-1  |     at file:///app/dist/index.js:4796:18
loan-copilot-app-1  |     at ModuleJob.run (node:internal/modules/esm/module_job:195:25)
loan-copilot-app-1  |     at async ModuleLoader.import (node:internal/modules/esm/loader:337:24)
loan-copilot-app-1  |     at async loadESM (node:internal/process/esm_loader:34:7)
loan-copilot-app-1  |     at async handleMainPromise (node:internal/modules/run_main:106:12) {
loan-copilot-app-1  |   code: 'ERR_INVALID_ARG_TYPE'
loan-copilot-app-1  | }
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | Node.js v18.20.8
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | > rest-express@1.0.0 start
loan-copilot-app-1  | > NODE_ENV=production node dist/index.js
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | OpenAI configuration: API key is set
loan-copilot-app-1  | node:internal/errors:496
loan-copilot-app-1  |     ErrorCaptureStackTrace(err);
loan-copilot-app-1  |     ^
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | TypeError [ERR_INVALID_ARG_TYPE]: The "paths[0]" argument must be of type string. Received undefined
loan-copilot-app-1  |     at new NodeError (node:internal/errors:405:5)
loan-copilot-app-1  |     at validateString (node:internal/validators:162:11)
loan-copilot-app-1  |     at Object.resolve (node:path:1115:7)
loan-copilot-app-1  |     at file:///app/dist/index.js:4796:18
loan-copilot-app-1  |     at ModuleJob.run (node:internal/modules/esm/module_job:195:25)
loan-copilot-app-1  |     at async ModuleLoader.import (node:internal/modules/esm/loader:337:24)
loan-copilot-app-1  |     at async loadESM (node:internal/process/esm_loader:34:7)
loan-copilot-app-1  |     at async handleMainPromise (node:internal/modules/run_main:106:12) {
loan-copilot-app-1  |   code: 'ERR_INVALID_ARG_TYPE'
loan-copilot-app-1  | }
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | Node.js v18.20.8
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | > rest-express@1.0.0 start
loan-copilot-app-1  | > NODE_ENV=production node dist/index.js
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | OpenAI configuration: API key is set
loan-copilot-app-1  | node:internal/errors:496
loan-copilot-app-1  |     ErrorCaptureStackTrace(err);
loan-copilot-app-1  |     ^
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | TypeError [ERR_INVALID_ARG_TYPE]: The "paths[0]" argument must be of type string. Received undefined
loan-copilot-app-1  |     at new NodeError (node:internal/errors:405:5)
loan-copilot-app-1  |     at validateString (node:internal/validators:162:11)
loan-copilot-app-1  |     at Object.resolve (node:path:1115:7)
loan-copilot-app-1  |     at file:///app/dist/index.js:4796:18
loan-copilot-app-1  |     at ModuleJob.run (node:internal/modules/esm/module_job:195:25)
loan-copilot-app-1  |     at async ModuleLoader.import (node:internal/modules/esm/loader:337:24)
loan-copilot-app-1  |     at async loadESM (node:internal/process/esm_loader:34:7)
loan-copilot-app-1  |     at async handleMainPromise (node:internal/modules/run_main:106:12) {
loan-copilot-app-1  |   code: 'ERR_INVALID_ARG_TYPE'
loan-copilot-app-1  | }
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | Node.js v18.20.8
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | > rest-express@1.0.0 start
loan-copilot-app-1  | > NODE_ENV=production node dist/index.js
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | OpenAI configuration: API key is set
loan-copilot-app-1  | node:internal/errors:496
loan-copilot-app-1  |     ErrorCaptureStackTrace(err);
loan-copilot-app-1  |     ^
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | TypeError [ERR_INVALID_ARG_TYPE]: The "paths[0]" argument must be of type string. Received undefined
loan-copilot-app-1  |     at new NodeError (node:internal/errors:405:5)
loan-copilot-app-1  |     at validateString (node:internal/validators:162:11)
loan-copilot-app-1  |     at Object.resolve (node:path:1115:7)
loan-copilot-app-1  |     at file:///app/dist/index.js:4796:18
loan-copilot-app-1  |     at ModuleJob.run (node:internal/modules/esm/module_job:195:25)
loan-copilot-app-1  |     at async ModuleLoader.import (node:internal/modules/esm/loader:337:24)
loan-copilot-app-1  |     at async loadESM (node:internal/process/esm_loader:34:7)
loan-copilot-app-1  |     at async handleMainPromise (node:internal/modules/run_main:106:12) {
loan-copilot-app-1  |   code: 'ERR_INVALID_ARG_TYPE'
loan-copilot-app-1  | }
loan-copilot-app-1  |
loan-copilot-app-1  |
loan-copilot-app-1  | Node.js v18.20.8
root@srv741469:/opt/loan-copilot#